Object.defineProperty(exports,"__esModule",{value:true});exports.createSelectCurrentRoute=exports.createSelectRoutes=exports.createSelectHistory=exports.createSelectCurrentPage=exports.createSelectFlow=exports.DEFAULT_FLOW_NAME=exports.DEFAULT_NAME_SPACE=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};exports.flowNavigationReducer=flowNavigationReducer;exports.flowInitalize=flowInitalize;exports.flowNext=flowNext;exports.flowBack=flowBack;exports.flowReset=flowReset;exports.flowInject=flowInject;exports.flowGoTo=flowGoTo;exports.flowClearInjections=flowClearInjections;var _reselect=require('reselect');function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}else{return Array.from(arr);}}var DEFAULT_NAME_SPACE=exports.DEFAULT_NAME_SPACE='flow';var DEFAULT_FLOW_NAME=exports.DEFAULT_FLOW_NAME='defaultFlow';var ACTION_ROOT='flow-navigation';var INITALIZE=ACTION_ROOT+'/INITALIZE';var NEXT=ACTION_ROOT+'/NEXT';var BACK=ACTION_ROOT+'/BACK';var INJECT=ACTION_ROOT+'/INJECT';var GOTO=ACTION_ROOT+'/GOTO';var RESET=ACTION_ROOT+'/RESET';var CLEAR_INJECTIONS=ACTION_ROOT+'/CLEAR_INJECTIONS';var injectRoute=function injectRoute(routes,route,index){var frontArray=routes.slice(0,index);var newFrontArray=frontArray.map(function(item){return _extends({},item,{currentPosition:-1});});var backArray=routes.slice(index,routes.length);return[].concat(_toConsumableArray(newFrontArray.concat([_extends({},route,{injected:true})]).concat(backArray)));};function getPosition(index,nextPage){if(index<nextPage){return-1;}else if(index===nextPage){return 0;}return 1;}function newRoutes(previousPage,nextPage,routes){var newArray=routes.map(function(item,index){return _extends({},item,{currentPosition:getPosition(index,nextPage)});});return newArray;}function clearInjections(routes,currentPage){var pageNumber=routes.map(function(item,index){if(item.injected&&item.currentPosition!==0){if(index<=currentPage){return currentPage-1;}return currentPage;}return null;});var array=routes.filter(function(item,index){return index===currentPage||item.currentPosition===0||!item.injected;});return{currentPage:pageNumber.filter(function(item){return item!==null;})[0]||currentPage,routes:array};}function flowNavigationReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var action=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var currentState=state[action.payload.flowName];switch(action.type){case INITALIZE:return _extends({},state,_defineProperty({},action.payload.flowName,{currentPage:0,history:[],routes:action.payload.routes}));case NEXT:return _extends({},state,_defineProperty({},action.payload.flowName,_extends({},currentState,{history:[].concat(_toConsumableArray(currentState.history),[currentState.currentPage]),currentPage:currentState.currentPage+1,routes:newRoutes(currentState.currentPage,currentState.currentPage+1,currentState.routes)})));case BACK:return _extends({},state,_defineProperty({},action.payload.flowName,_extends({},currentState,{history:currentState.history.slice(0,currentState.history.length-1),currentPage:currentState.currentPage-1,routes:newRoutes(currentState.currentPage,currentState.currentPage-1,currentState.routes)})));case INJECT:return _extends({},state,_defineProperty({},action.payload.flowName,_extends({},currentState,{currentPage:currentState.currentPage+1,history:[].concat(_toConsumableArray(currentState.history),[currentState.currentPage]),routes:injectRoute(currentState.routes,action.payload.route,action.payload.index+1)})));case GOTO:return _extends({},state);case RESET:return _extends({},state,_defineProperty({},action.payload.flowName,_extends({},currentState,{history:[],currentPage:0,routes:action.payload.routes})));case CLEAR_INJECTIONS:return _extends({},state,_defineProperty({},action.payload.flowName,_extends({},currentState,clearInjections(currentState.routes,currentState.currentPage))));default:return state;}}var createSelectNameSpace=function createSelectNameSpace(){var nameSpace=arguments.length>0&&arguments[0]!==undefined?arguments[0]:DEFAULT_NAME_SPACE;return function(state){return state[nameSpace]||{};};};var createSelectFlow=exports.createSelectFlow=function createSelectFlow(){var flowName=arguments.length>0&&arguments[0]!==undefined?arguments[0]:DEFAULT_FLOW_NAME;var nameSpace=arguments.length>1&&arguments[1]!==undefined?arguments[1]:DEFAULT_NAME_SPACE;return(0,_reselect.createSelector)(createSelectNameSpace(nameSpace),function(state){return state.flowName||{};});};var createSelectCurrentPage=exports.createSelectCurrentPage=function createSelectCurrentPage(){var flowName=arguments.length>0&&arguments[0]!==undefined?arguments[0]:DEFAULT_FLOW_NAME;var nameSpace=arguments.length>1&&arguments[1]!==undefined?arguments[1]:DEFAULT_NAME_SPACE;return(0,_reselect.createSelector)(createSelectFlow(flowName,nameSpace),function(state){return state.currentPage||0;});};var createSelectHistory=exports.createSelectHistory=function createSelectHistory(){var flowName=arguments.length>0&&arguments[0]!==undefined?arguments[0]:DEFAULT_FLOW_NAME;var nameSpace=arguments.length>1&&arguments[1]!==undefined?arguments[1]:DEFAULT_NAME_SPACE;return(0,_reselect.createSelector)(createSelectFlow(flowName,nameSpace),function(state){return state.history||{};});};var createSelectRoutes=exports.createSelectRoutes=function createSelectRoutes(){var flowName=arguments.length>0&&arguments[0]!==undefined?arguments[0]:DEFAULT_FLOW_NAME;var nameSpace=arguments.length>1&&arguments[1]!==undefined?arguments[1]:DEFAULT_NAME_SPACE;return(0,_reselect.createSelector)(createSelectFlow(flowName,nameSpace),function(state){return state.routes||[];});};var createSelectCurrentRoute=exports.createSelectCurrentRoute=function createSelectCurrentRoute(){var flowName=arguments.length>0&&arguments[0]!==undefined?arguments[0]:DEFAULT_FLOW_NAME;var nameSpace=arguments.length>1&&arguments[1]!==undefined?arguments[1]:DEFAULT_NAME_SPACE;return(0,_reselect.createSelector)(createSelectFlow(flowName,nameSpace),function(state){return state.routes[state.currentPage]||{};});};function flowInitalize(routes){var flowName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:DEFAULT_FLOW_NAME;return{type:INITALIZE,payload:{routes:routes,flowName:flowName}};}function flowNext(){var flowName=arguments.length>0&&arguments[0]!==undefined?arguments[0]:DEFAULT_FLOW_NAME;return{type:NEXT,payload:{flowName:flowName}};}function flowBack(){var flowName=arguments.length>0&&arguments[0]!==undefined?arguments[0]:DEFAULT_FLOW_NAME;return{type:BACK,payload:{flowName:flowName}};}function flowReset(routes){var flowName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:DEFAULT_FLOW_NAME;return{type:RESET,payload:{routes:routes,flowName:flowName}};}function flowInject(route,index){var flowName=arguments.length>2&&arguments[2]!==undefined?arguments[2]:DEFAULT_FLOW_NAME;return{type:INJECT,payload:{route:route,index:index,flowName:flowName}};}function flowGoTo(routeName){return{type:GOTO,payload:{routeName:routeName}};}function flowClearInjections(){var flowName=arguments.length>0&&arguments[0]!==undefined?arguments[0]:DEFAULT_FLOW_NAME;return{type:CLEAR_INJECTIONS,payload:{fĺowName:fĺowName}};}